<!DOCTYPE html>
<html>
  <head>
    <title>Brownian</title>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript">
      (function () {

        var WIDTH = 640,
            HEIGHT = 480,
            COUNT = 500,
            R = 2;

        function rand(max) {
          return Math.ceil(Math.random() * max);
        }

        window.onload = function() {

          var svg = d3.select('#container')
            .append('svg')
            .attr('width', WIDTH)
            .attr('height', HEIGHT)
            .style('background-color', 'black');

          // particles
          var p = [];

          for (var i = 0; i < COUNT; i++) {
            var x = rand(WIDTH),
                y = rand(HEIGHT);

            var particle = svg.append('circle')
              .attr('r', R)
              .attr('cx', x)
              .attr('cy', y)
              .style('fill', 'red');

            p[i] = {
              el: particle,
              x: x,
              y: y,
              vx: rand(6) - 3 || 1,
              vy: rand(6) - 3 || 1
            }
          }

          function loop() {
            for (var i = 0; i < COUNT; i++) {
              // boundaries
              if (p[i].x > WIDTH - R) {
                p[i].x = WIDTH - R;
                p[i].vx *= -1;
              }

              if (p[i].x < R) {
                p[i].x = R;
                p[i].vx *= -1;
              }

              if (p[i].y > HEIGHT - R) {
                p[i].y = HEIGHT - R;
                p[i].vy *= -1;
              }

              if (p[i].y < R) {
                p[i].y = R;
                p[i].vy *= -1;
              }

              // step
              p[i].x += p[i].vx;
              p[i].y += p[i].vy;

              p[i].el
                .attr('cx', p[i].x)
                .attr('cy', p[i].y);
            }

            requestAnimationFrame(loop);
          }

          loop();
        }
      })();
    </script>
  </head>
  <body>
    <div id="container"></div>
  </body>
</html>